<!DOCTYPE html>
<html prefix="
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Single threaded stories.">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rebeja · Rebeja (old posts, page 1) </title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.1.7/css/fork-awesome.min.css" integrity="sha256-gsmEoJAws/Kd3CjuOQzLie5Q3yshhvmo7YNtBG7aaEY=" crossorigin="anonymous">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="https://rebeja.eu/index-1.html">
<link rel="prev" href="." type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body class="">
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div class="hsidebar">
        <div class="container sidebar-sticky">
                <nav id="menu" role="navigation" class="sidebar-nav"><a class="sidebar-nav-item" href="index.html" title="Home"><i class="fa fa-home"></i>Home</a>
            <a class="sidebar-nav-item" href="archive.html" title="Archive"><i class="fa fa-folder-open"></i>Archive</a>
            <a class="sidebar-nav-item" href="categories/index.html" title="Tags"><i class="fa fa-tags"></i>Tags</a>
            <a class="sidebar-nav-item" href="pages/welcome/" title="About"><i class="fa fa-user"></i>About</a>
            <a class="sidebar-nav-item" href="tehnologii-web/" title="Teaching"><i class="fa fa-graduation-cap"></i>Teaching</a>
            <a class="sidebar-nav-item" href="pages/en-ro-dictionary-for-ai" title="EN-RO 4 AI"><i class="fa fa-book"></i>EN-RO 4 AI</a>
            <a class="sidebar-nav-item" href="rss.xml" title="RSS"><i class="fa fa-feed"></i>RSS</a>
    
    
    </nav><footer id="footer"><span class="copyright">
              Contents © 2025         <a href="mailto:petru.rebeja@gmail.com">Petru Rebeja</a> - Powered by   <a href="https://www.gnu.org/software/emacs/" rel="nofollow">GNU Emacs</a>  &amp;    <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            </span>
            
            
        </footer>
</div>
    </div>
    <div class="content container" id="content">
    
<div class="post">
    <article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/python-development-using-emacs-from-terminal/" class="u-url">Python development using Emacs from terminal</a></h1>
        <div class="metadata">
            <p class="dateline">
              <i class="fa fa-clock-o"></i> <time class="published dt-published" datetime="2017-09-29T00:00:00+02:00" title="2017-09-29 00:00">2017-09-29 00:00</time>
            
                |   <i class="fa fa-comment"></i>         <a href="posts/python-development-using-emacs-from-terminal/#disqus_thread" data-disqus-identifier="cache/posts/python-development-using-emacs-from-terminal.html">Comments</a>


            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>
A few weeks ago, while working on a hackathon project I found myself very disappointed with my progress.
</p>

<p>
I had the impression that I can do better but something is holding me back and then I realized that I was too distracted by <code>Alt-Tab</code>-ing through all open applications, iterating through dozens of open tabs in the browser and spending too much time on websites that were of no use at that time.
</p>

<p>
At that moment, on a whim I decided to try and eliminate all of these distractions the hard way - <b>by not using the X server at all</b> (I was working on <a href="https://kubuntu.org/">Kubuntu</a>).
</p>

<p>
Since I was mainly working with Python code and occasionally I would need to open some file for inspection and all of these were done from Emacs I said to myself:
</p>
<blockquote>
<p>
Emacs can be opened from console so why not start working on hackathon from console?
</p>
</blockquote>
<p>
Said and done. <code>Ctrl-Alt-F1</code> and I was prompted with the TTY cursor. I logged in, started Emacs opened all the required files and started working. All good until I found myself in the situation where I needed to lookup something on the Internet. I knew I could use <code>eww</code> as a web browser so normally I did so (yeah, I'm one of those people that use Bing instead of Google):
</p>
<div class="highlight"><pre><span></span>M-x<span class="w"> </span>eww
Enter<span class="w"> </span>URL<span class="w"> </span>or<span class="w"> </span>keywords:<span class="w"> </span>www.bing.com
</pre></div>
<p>
And nothing… Oh, wait, I remember needing to enter some username and password when connecting to the Wi-Fi but I wasn't prompted for those after logging into terminal. How do I connect to the network?
</p>

<p>
As there was no way for me to find that out without using some sort of GUI (I'm not that good with terminals) I started a new X session, connected from there to Wi-Fi and found this <a href="https://askubuntu.com/a/461831/561980">StackOverflow answer</a>. So I logged back to the terminal and from Emacs started <b>eshell</b> with <code>M-x eshell</code>. From there I issued the following command
</p>
<div class="highlight"><pre><span></span>nmcli<span class="w"> </span>c<span class="w"> </span>up<span class="w"> </span>&lt;wi-fi-name&gt;
</pre></div>
<p>
which connected me to the Wi-Fi network.
</p>

<p>
Note: I got connected because on previous sessions I opted to store the credentials for the connection; to get a prompt for username and password for the Wi-Fi use the <code>--ask</code> parameter like this:
</p>
<div class="highlight"><pre><span></span>nmcli<span class="w"> </span>--ask<span class="w"> </span>c<span class="w"> </span>up<span class="w"> </span>&lt;wi-fi-name&gt;
</pre></div>

<p>
After connecting I resumed my coding and only at the end of the hackathon I stopped to ponder upon my experience; it wasn't as smooth as I expected. Although I consider a big plus the fact that I was able to issue shell commands within Emacs through <b>eshell</b> there were some hick-ups along the way.
</p>

<p>
The first thing I noticed is that under terminal not all shortcuts that are very familiar for me are available. Namely, in <b>org-mode</b> the combination <code>M-right</code> which is used for indentation, moving columns within a table and demoting list items is not available; instead I had to use either <code>C-c C-x r</code> shortcut or explicitly invoke the command using <code>M-x org-meta-right</code>. Although I did not invoke this command frequently, without the shortcut I felt like I was pulled out of <a href="https://en.wikipedia.org/wiki/Flow_(psychology)">the flow</a> each time I had to use an alternative method of invoking the command.
</p>

<p>
The second and by far the biggest nuisance was the lack of proper web-browsing experience. Although I most frequently landed on StackOverflow pages and although <b>eww</b> rendered them pretty good (see image below) the lack of visual experience <i>I was used to</i> gave me a sense of discomfort.
<img src="images/eww-stackoverflow-2.png" alt="nil"></p>

<p>
However, when I got to analyze how much I have accomplished while working from terminal I was simply <b>amazed</b>. Having no distraction and meaningless motion like cycling through windows and tabs had a huge impact on my productivity. I was able to fully concentrate and immerse in the code and by doing so I had <b>a lot</b> of work done.
</p>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/rename-multiple-files-with-emacs-dired/" class="u-url">Rename multiple files with Emacs dired</a></h1>
        <div class="metadata">
            <p class="dateline">
              <i class="fa fa-clock-o"></i> <time class="published dt-published" datetime="2017-08-22T00:00:00+02:00" title="2017-08-22 00:00">2017-08-22 00:00</time>
            
                |   <i class="fa fa-comment"></i>         <a href="posts/rename-multiple-files-with-emacs-dired/#disqus_thread" data-disqus-identifier="cache/posts/rename-multiple-files-with-emacs-dired.html">Comments</a>


            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>
While adding text files from within a folder to a project file I noticed that the files in the folder were lacking naming consistency. Namely, there were files which had the <code>.txt</code> extension and files without extension, as shown in the image below:
<img src="images/emacs-dired-files-without-extension.png" alt="nil"></p>

<p>
Since there were about 100 files without extension I started asking myself: <b>Is there a way to add .txt extension to those files without manually renaming each one</b>?
</p>

<p>
Of course there is. Here's what I did using Emacs and <code>dired</code>:
</p>
<ul class="org-ul">
<li>
<code>M-x dired</code> to the desired directory (obviously)</li>
<li>In the <code>dired</code> buffer enter the <b>edit mode</b> with <code>C-x C-q</code>
</li>
<li>Go to the last file that has extension before the block of files without extension.</li>
<li>Starting from that file, place a mark and select the whole block of files without extension (the selection should include the last file with extension).</li>
<li>Narrow to the selected region using <code>M-x narrow-to-region</code> or <code>C-x n n</code> The buffer should look like the image below:
<img src="images/emacs-dired-narrowed.png" alt="nil">
</li>
<li>Move to the beginning of buffer using <code>M-&lt;</code>
</li>
<li>Start defining a new keyboard macro using <code>C-x (</code>
<ul class="org-ul">
<li>Move to next line using <code>C-n</code>
</li>
<li>Navigate to the end of line using <code>C-e</code>
</li>
<li>Add the <code>.txt</code> extension</li>
</ul>
</li>
<li>Save the macro with <code>C-x )</code>
</li>
<li>Now that I have a macro to add <code>.txt</code> extension to a file name I just need to run it as many times as there are unnamed files (100 in my case). To do so just <code>C-u 100 F4</code>. This will repeat the macro 100 times.</li>
<li>Once all the files are renamed exit the <b>narrow-region</b> using <code>M-x widen</code> or <code>C-x n w</code>
</li>
<li>Save changes with <code>C-c C-c</code>
</li>
</ul>
<p>
That's it!
</p>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/managing-bibliography-using-emacs-org-mode-and-org-ref/" class="u-url">Managing bibliography using Emacs Org-Mode and Org-Ref</a></h1>
        <div class="metadata">
            <p class="dateline">
              <i class="fa fa-clock-o"></i> <time class="published dt-published" datetime="2017-07-29T00:00:00+02:00" title="2017-07-29 00:00">2017-07-29 00:00</time>
            
                |   <i class="fa fa-comment"></i>         <a href="posts/managing-bibliography-using-emacs-org-mode-and-org-ref/#disqus_thread" data-disqus-identifier="cache/posts/managing-bibliography-using-emacs-org-mode-and-org-ref.html">Comments</a>


            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>
Since I've started to use Emacs more and more I started wondering whether I can use org-mode to keep a reading list/bibliography?
</p>

<p>
A quick search led me to this <a href="http://blog.modelworks.ch/">blog post</a> where the author was presenting his setup for the same thing. However, after reading into the post I saw that the author
uses a combination of tasks and a reading list which requires custom code to be executed and is too complex for my needs.
</p>

<p>
All I want is a simple list that:
</p>
<ul class="org-ul">
<li>should be available on multiple workstations</li>
<li>can be built/managed with out-of-the-shelf components and without much effort</li>
<li>should allow me to change the status of an entry.</li>
</ul>
<p>
I did however liked the idea of using references to the papers being read and since I recently saw a <a href="https://www.youtube.com/watch?v=JyvpSVl4_dg">YouTube video</a> presenting <code>org-ref</code> I thought I should give it a try.
</p>

<p>
To handle the availability part I decided to use Dropbox which is also suggested by <code>org-ref</code>.
</p>
<div id="outline-container-orgbd7d5bf" class="outline-2">
<h2 id="orgbd7d5bf">Setup org-ref</h2>
<div class="outline-text-2" id="text-orgbd7d5bf">
<p>
<code>org-ref</code> is available on <a href="http://melpa.org/">Melpa</a> so to install it just type <code>M-x package-install org-ref</code>. Afterwards copy the code below to your init file and adjust the paths:
</p>
<div class="highlight"><pre><span></span><span class="w">  </span><span class="p">(</span><span class="nf">setq</span><span class="w"> </span><span class="nv">reftex-default-bibliography</span><span class="w"> </span><span class="o">'</span><span class="p">(</span><span class="s">"~/Dropbox/bibliography/references.bib"</span><span class="p">))</span>
<span class="w">  </span><span class="c1">;; see org-ref for use of these variables</span>
<span class="w">  </span><span class="p">(</span><span class="nf">setq</span><span class="w"> </span><span class="nv">org-ref-bibliography-notes</span><span class="w"> </span><span class="s">"~/Dropbox/bibliography/notes.org"</span>
<span class="w">        </span><span class="nv">org-ref-default-bibliography</span><span class="w"> </span><span class="o">'</span><span class="p">(</span><span class="s">"~/Dropbox/bibliography/references.bib"</span><span class="p">)</span>
<span class="w">        </span><span class="nv">org-ref-pdf-directory</span><span class="w"> </span><span class="s">"~/Dropbox/bibliography/bibtex-pdfs/"</span><span class="p">)</span>

<span class="w">  </span><span class="p">(</span><span class="nf">setq</span><span class="w"> </span><span class="nv">bibtex-completion-bibliography</span><span class="w"> </span><span class="s">"~/Dropbox/bibliography/references.bib"</span>
<span class="w">        </span><span class="nv">bibtex-completion-library-path</span><span class="w"> </span><span class="s">"~/Dropbox/bibliography/bibtex-pdfs"</span>
<span class="w">        </span><span class="nv">bibtex-completion-notes-path</span><span class="w"> </span><span class="s">"~/Dropbox/bibliography/helm-bibtex-notes"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div id="outline-container-org0dd4d4f" class="outline-2">
<h2 id="org0dd4d4f">Creating the reading list</h2>
<div class="outline-text-2" id="text-org0dd4d4f">
<p>
With <code>org-ref</code> in place, it was time to setup the reading list so I created a new file named <code>reading-list.org</code> under <code>~/Dropbox/bibliography/</code> with the following header:
</p>
<div class="highlight"><pre><span></span><span class="w">  </span><span class="c1">#+TITLE: Reading list</span>
<span class="w">  </span><span class="c1">#+STATUS: "Maybe" "Pending" "Reading" "Finished" ""</span>
<span class="w">  </span><span class="c1">#+COLUMNS: %120ITEM %STATUS</span>
</pre></div>
<p>
The first line obviously defines the title of the document. The second line defines the values for status where:
</p>
<ul class="org-ul">
<li>
<code>Maybe</code> means that reading the entry is optional</li>
<li>
<code>Pending</code> - the entry will be read sometime after finishing the item that I'm currently reading</li>
<li>
<code>Reading</code> - the item currently being read</li>
<li>
<code>Finished</code> - the entries that are already read.</li>
</ul>
</div>
</div>
<div id="outline-container-orgb2976a9" class="outline-2">
<h2 id="orgb2976a9">Adding an entry to the list</h2>
<div class="outline-text-2" id="text-orgb2976a9">
<ul class="org-ul">
<li>
<p>
Add <code>bibtex</code> entry in <code>references.bib</code> file. E.g.:
</p>
<div class="highlight"><pre><span></span><span class="w">    </span>@inproceedings<span class="o">{</span>le2014distributed,
<span class="w">      </span><span class="nv">title</span><span class="o">={</span>Distributed<span class="w"> </span>representations<span class="w"> </span>of<span class="w"> </span>sentences<span class="w"> </span>and<span class="w"> </span>documents<span class="o">}</span>,
<span class="w">      </span><span class="nv">author</span><span class="o">={</span>Le,<span class="w"> </span>Quoc<span class="w"> </span>and<span class="w"> </span>Mikolov,<span class="w"> </span>Tomas<span class="o">}</span>,
<span class="w">      </span><span class="nv">booktitle</span><span class="o">={</span>Proceedings<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>31st<span class="w"> </span>International<span class="w"> </span>Conference<span class="w"> </span>on<span class="w"> </span>Machine<span class="w"> </span>Learning<span class="w"> </span><span class="o">(</span>ICML-14<span class="o">)}</span>,
<span class="w">      </span><span class="nv">pages</span><span class="o">={</span><span class="m">1188</span>--1196<span class="o">}</span>,
<span class="w">      </span><span class="nv">year</span><span class="o">={</span><span class="m">2014</span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>
</pre></div>
</li>
<li>In the <code>reading-list.org</code> file add the title to the list using <code>M-return</code>
</li>
<li>Add <code>Status</code> and <code>Source</code> properties
<ul class="org-ul">
<li>With the cursor on the header:
<ul class="org-ul">
<li>Press <code>C-c C-x p</code>
</li>
<li>Select or write <code>Status</code>
</li>
<li>Press return</li>
<li>Select the value for status (e. g. <code>Pending</code>)</li>
<li>Press return</li>
</ul>
</li>
<li>With the cursor on the header:
<ul class="org-ul">
<li>Press <code>C-c C-x p</code>
</li>
<li>Write or select <code>Source</code>
</li>
<li>Press return</li>
<li>If you know the citation key (le2014distributed in the example above) then you can write directly <code>cite:le2014distributed</code>; otherwise, leave the value for <code>Source</code> empty and put the cursor after the property declaration. Then, press <code>C-c ]</code> and select the entry from the reference list.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>
Repeat the steps above and you should end up with a list like this:
<img src="images/emacs-reading-list.png" alt="nil"></p>
</div>
</div>
<div id="outline-container-org478c003" class="outline-2">
<h2 id="org478c003">Change the status of an entry</h2>
<div class="outline-text-2" id="text-org478c003">
<p>
To change the status of an entry:
</p>
<ul class="org-ul">
<li>Navigate to the desired entry</li>
<li>Repeat the steps above for setting the <code>Status</code> property and select the proper value for <code>Status</code>
</li>
</ul>
</div>
</div>
<div id="outline-container-orga4aafd8" class="outline-2">
<h2 id="orga4aafd8">Status overview</h2>
<div class="outline-text-2" id="text-orga4aafd8">
<p>
After creating the list you may want to have an overview of the status for each entry. This can be achieved using <code>Org Column View</code>.
The setup for column view is in the third line of the header
</p>
<div class="highlight"><pre><span></span><span class="w">  </span><span class="c1">#+COLUMNS: %120ITEM %STATUS</span>
</pre></div>
<p>
which tells org-mode how to display the entries. Namely, we're defining two columns:
</p>
<ol class="org-ol">
<li>
<b>Item</b> which will display the heading on 120 characters and</li>
<li>
<b>Status</b> which will take as much space as needed to display the status</li>
</ol>
</div>
<div id="outline-container-orgd90e79b" class="outline-3">
<h3 id="orgd90e79b">Switching to column view</h3>
<div class="outline-text-3" id="text-orgd90e79b">
<p>
To switch to column view, place the cursor outside the headings and press <code>C-c C-x C-c</code> (or <code>M-x org-columns</code>). The list should look like the image below:
<img src="images/emacs-reading-list-column-view.png" alt="nil">
If your cursor was on a heading when pressing <code>C-c C-x C-c</code> (invoking <code>org-columns</code>) then the column view will be activated only for the selected heading.
</p>
</div>
</div>
<div id="outline-container-org76f320d" class="outline-3">
<h3 id="org76f320d">Exiting column view</h3>
<div class="outline-text-3" id="text-org76f320d">
<p>
To exit column view position the cursor on a heading that is currently in column view and press <code>q</code>.
</p>

<p>
That's it. Happy reading!
</p>
</div>
</div>
</div>
<div id="outline-container-orgba8b63d" class="outline-2">
<h2 id="orgba8b63d">References</h2>
<div class="outline-text-2" id="text-orgba8b63d">
<ol class="org-ol">
<li><a href="https://github.com/jkitchin/org-ref/blob/master/org-ref.org#start-of-content">The org-ref manual</a></li>
<li><a href="http://blog.modelworks.ch/managing-papers-with-org-mode-and-reftex/">Managing papers with Org-Mode and RefTex</a></li>
<li><a href="http://orgmode.org/org.html#Defining-columns">Org Manual - Defining columns</a></li>
</ol>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/adding-disqus-comments-to-ghost-blog-on-azure/" class="u-url">Adding Disqus comments to Ghost blog on Azure</a></h1>
        <div class="metadata">
            <p class="dateline">
              <i class="fa fa-clock-o"></i> <time class="published dt-published" datetime="2017-06-22T00:00:00+02:00" title="2017-06-22 00:00">2017-06-22 00:00</time>
            
                |   <i class="fa fa-comment"></i>         <a href="posts/adding-disqus-comments-to-ghost-blog-on-azure/#disqus_thread" data-disqus-identifier="cache/posts/adding-disqus-comments-to-ghost-blog-on-azure.html">Comments</a>


            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>
If you have a <a href="https://ghost.org/">Ghost</a> hosted on <a href="https://azure.microsoft.com/">Azure</a> (like I did) then you may want to add <a href="https://disqus.com/">Disqus</a> comments to it (like I did).
</p>

<p>
To do so, follow the steps below:
</p>
<ol class="org-ol">
<li>
<a href="https://disqus.com/profile/signup/">Create a Disqus account</a> if you haven't done so already.</li>
<li>
<a href="https://disqus.com/profile/login/">Login to Disqus</a> and navigate to the admin page.</li>
<li>Click on <a href="https://disqus.com/profile/login/?next=/admin/install/">Install Disqus</a> and choose <a href="https://disqus.com/admin/install/platforms/ghost/">Ghost</a> from the list.</li>
<li>Open a new tab and navigate to <a href="https://portal.azure.com/">Azure portal</a> and from the dashboard open/navigate to the application hosting your Ghost blog.</li>
<li>On the application blade select <code>App Service Editor</code> and press <code>Go-&gt;</code> to open the editor for your blog.</li>
<li>In the editor navigate to <code>wwwroot\content\themes\&lt;your-theme&gt;\post.hbs</code>. This will load the file in the panel on the right.</li>
<li>Go back to <a href="https://disqus.com/admin/install/platforms/ghost/">Ghost Install Instructions</a> on Disqus and copy the <a href="https://disqus.com/admin/install/platforms/universalcode/">Universal Embed Code</a>.</li>
<li>Paste the code into post.hbs file in the place where you want your comment section to be.</li>
<li>
<p>
Find the section to define configuration variables and make it look like this:
</p>
<div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">var</span><span class="w"> </span><span class="nx">disqus_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="k">this</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'{{@blog.url}}{{url}}'</span><span class="p">;</span>
<span class="w">       </span><span class="k">this</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">identifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'{{id}}'</span><span class="p">;</span>
<span class="w">   </span><span class="p">};</span>
</pre></div>
</li>
</ol>
<p>
Happy blogging!
</p>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/use-emacs-sql-mode-to-connect-to-database-on-a-docker-image/" class="u-url">Use Emacs sql-mode to connect to database on a Docker image</a></h1>
        <div class="metadata">
            <p class="dateline">
              <i class="fa fa-clock-o"></i> <time class="published dt-published" datetime="2017-06-21T00:00:00+02:00" title="2017-06-21 00:00">2017-06-21 00:00</time>
            
                |   <i class="fa fa-comment"></i>         <a href="posts/use-emacs-sql-mode-to-connect-to-database-on-a-docker-image/#disqus_thread" data-disqus-identifier="cache/posts/use-emacs-sql-mode-to-connect-to-database-on-a-docker-image.html">Comments</a>


            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>
While working on a project I had to load and process some resources from a MySQL database. I had a database dump and all I needed was to <code>sudo apt-get install mysql</code> but I decided against it because that would just bloat my OS with software used only once and drain my laptop battery with the service running in the background.
</p>

<p>
Instead, I decided to restore the database on a Docker image for MySQL and query the data using <code>mysql-client</code>.
</p>
<div id="outline-container-org9f89060" class="outline-2">
<h2 id="org9f89060">Install <code>mysql-client</code> locally</h2>
<div class="outline-text-2" id="text-org9f89060">
<p>
This one is simple; just run:
</p>
<div class="highlight"><pre><span></span><span class="w">  </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>mysql-client
</pre></div>
</div>
</div>
<div id="outline-container-org65c78e0" class="outline-2">
<h2 id="org65c78e0">Install Docker on Ubuntu</h2>
<div class="outline-text-2" id="text-org65c78e0">
<p>
The first thing to do is to head to <a href="https://docs.docker.com/engine/installation/linux/ubuntu/#install-docker">Docker documentation</a> for instalation instructions which I've copied here:
</p>
<ul class="org-ul">
<li>
<p>
Install packages to allow <code>apt</code> to use a repository over HTTPS:
</p>
<div class="highlight"><pre><span></span><span class="w">   </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span><span class="se">\</span>
<span class="w">       </span>apt-transport-https<span class="w"> </span><span class="se">\</span>
<span class="w">       </span>ca-certificates<span class="w"> </span><span class="se">\</span>
<span class="w">       </span>curl<span class="w"> </span><span class="se">\</span>
<span class="w">       </span>software-properties-common
</pre></div>
</li>
<li>
<p>
Add the official GPG key for Docker
</p>
<div class="highlight"><pre><span></span><span class="w">   </span>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://download.docker.com/linux/ubuntu/gpg<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>apt-key<span class="w"> </span>add<span class="w"> </span>-
</pre></div>
</li>
<li>
<p>
Setup the <b>stable</b> repository. Make sure to select the proper architecture; in my case it's <code>amd64</code>
</p>
<div class="highlight"><pre><span></span><span class="w">   </span>sudo<span class="w"> </span>add-apt-repository<span class="w"> </span><span class="se">\</span>
<span class="w">       </span><span class="s2">"deb [arch=amd64] https://download.docker.com/linux/ubuntu \</span>
<span class="s2">       </span><span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span><span class="s2"> \</span>
<span class="s2">       stable"</span>
</pre></div>
</li>
<li>
<p>
Update the package index
</p>
<div class="highlight"><pre><span></span><span class="w">   </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>update
</pre></div>
</li>
<li>
<p>
Install Docker
</p>
<div class="highlight"><pre><span></span><span class="w">   </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>docker-ce
</pre></div>
</li>
</ul>
</div>
</div>
<div id="outline-container-org12bc59c" class="outline-2">
<h2 id="org12bc59c">Restore MySQL database to a Docker container</h2>
<div class="outline-text-2" id="text-org12bc59c">
<ul class="org-ul">
<li>
<p>
Download the Docker image for <code>MySQL</code>
</p>
<div class="highlight"><pre><span></span><span class="w">   </span>sudo<span class="w"> </span>docker<span class="w"> </span>pull<span class="w"> </span>mysql
</pre></div>
</li>
<li>
<p>
Create an empty database
</p>
<div class="highlight"><pre><span></span><span class="w">   </span>sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>--name<span class="w"> </span>&lt;container-name&gt;<span class="w"> </span>-e<span class="w"> </span><span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span>&lt;password&gt;<span class="w"> </span>-e<span class="w"> </span><span class="nv">MYSQL_DATABASE</span><span class="o">=</span>&lt;db-name&gt;<span class="w"> </span>-d<span class="w"> </span>mysql
</pre></div>
<p>
This will create a new container with an empty database and login <code>root</code>.
</p>
</li>
<li>
<p>
Restore database from dump
</p>
<div class="highlight"><pre><span></span><span class="w">   </span>sudo<span class="w"> </span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-i<span class="w"> </span>&lt;container-name&gt;<span class="w"> </span>mysql<span class="w"> </span>-u&lt;user-name&gt;<span class="w"> </span>-p&lt;password&gt;<span class="w"> </span>--database<span class="o">=</span>&lt;db-name&gt;<span class="w"> </span>&lt;<span class="w"> </span>&lt;path-to-sql-file&gt;
</pre></div>
<p>
Notes:
</p>
<ol class="org-ol">
<li>Make sure that there is no space between <code>-u</code> and <code>&lt;user-name&gt;</code>, e.g. for user <code>root</code> the option should be <code>-uroot</code>
</li>
<li>The same goes for password - e.g. if password is <code>my-secret</code> then the option should be <code>-pmy-secret</code>
</li>
<li>
<code>path-to-sql-file</code> should point to a file on host OS</li>
</ol>
</li>
</ul>
</div>
</div>
<div id="outline-container-org1096016" class="outline-2">
<h2 id="org1096016">Connect to MySQL database running on Docker container from Emacs</h2>
<div class="outline-text-2" id="text-org1096016">
<ul class="org-ul">
<li>First, start the container <code>sudo docker start &lt;container-name&gt;</code>
</li>
<li>Get the IP Address of the container</li>
<li>Get the container configuration using <code>sudo docker inspect &lt;container-name&gt;</code>
</li>
<li>Copy the IP Address from the output under <code>NetworkSettings/IPAddress</code>
</li>
<li>In Emacs execute <code>M-x sql-mysql</code>
<ul class="org-ul">
<li>For <code>User:</code> enter the value for <code>&lt;user-name&gt;</code> (<code>root</code> is the default)</li>
<li>For <code>Password:</code> enter the value for <code>&lt;password&gt;</code>
</li>
<li>For <code>Database:</code> enter the value for <code>&lt;db-name&gt;</code>
</li>
<li>For <code>Server:</code> enter the IP Address from 2.</li>
</ul>
</li>
</ul>
<p>
That's it. Happy querying!
</p>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/editing-remote-files-over-ssh-with-emacs-and-tramp-mode/" class="u-url">Editing remote files over ssh with Emacs and Tramp mode</a></h1>
        <div class="metadata">
            <p class="dateline">
              <i class="fa fa-clock-o"></i> <time class="published dt-published" datetime="2017-05-15T00:00:00+02:00" title="2017-05-15 00:00">2017-05-15 00:00</time>
            
                |   <i class="fa fa-comment"></i>         <a href="posts/editing-remote-files-over-ssh-with-emacs-and-tramp-mode/#disqus_thread" data-disqus-identifier="cache/posts/editing-remote-files-over-ssh-with-emacs-and-tramp-mode.html">Comments</a>


            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>
In a discussion over a beer, a friend of mine asked whether I know a way to edit remote files over <code>ssh</code>? It was then that I realized that my long time obsession with Emacs is starting to pay off and I gave him the only way I know how to do that: <b>Emacs and <a href="https://www.emacswiki.org/emacs/TrampMode">Tramp Mode</a></b>.
</p>

<p>
This is how I do it.
</p>
<div id="outline-container-org35abd41" class="outline-2">
<h2 id="org35abd41">Setup</h2>
<div class="outline-text-2" id="text-org35abd41">
<p>
I use <code>Emacs 25.2</code> on Kubuntu 17.04 and on Windows 10 using <a href="http://cygwin.com/">Cygwin</a> and when working with remote files both systems behave the same.
</p>
</div>
</div>
<div id="outline-container-orgfb58270" class="outline-2">
<h2 id="orgfb58270">The flow</h2>
<div class="outline-text-2" id="text-orgfb58270">
<ol class="org-ol">
<li>Configure the remote machine to authenticate you with a key file as specified in this <a href="https://askubuntu.com/a/20921/561980">stackoverflow answer</a>
</li>
<li>Start Emacs</li>
</ol>
<p>
To open the remote file for editing invoke the <code>find-file</code> command either using <code>C-x C-f</code> (<code>C = Ctrl</code>) or with <code>M-x find-file</code> (<code>M=Alt</code>) and at the file prompt specify the path in the following format:
</p>
<div class="highlight"><pre><span></span><span class="w">  </span>/ssh:user@ip<span class="o">[</span>:port<span class="o">]</span>:path/to/file
</pre></div>
</div>
</div>
<div id="outline-container-org52daca5" class="outline-2">
<h2 id="org52daca5">An example</h2>
<div class="outline-text-2" id="text-org52daca5">
<p>
To exemplify let's consider the following scenario: I have a virtual machine with the IP <code>192.168.13.13</code> to which I can connect remotely with <code>ssh</code> using the username <code>petru</code> and the default public key (<b>~/.ssh/id<sub>rsa.pub</sub></b>). On that machine I want to edit the file <code>/home/petru/src/debugutils.py</code>.
</p>

<p>
To do so, I open the file as usually in Emacs using <code>C-x C-f</code> and at the prompt (the minibuffer) I enter the following:
</p>
<div class="highlight"><pre><span></span><span class="w">  </span>/ssh:petru@192.168.13.13:/home/petru/src/debugutils.py
</pre></div>
<p>
and press <code>&lt;Enter&gt;</code>.
</p>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/using-enums-in-c-sharp/" class="u-url">Using enums in C#</a></h1>
        <div class="metadata">
            <p class="dateline">
              <i class="fa fa-clock-o"></i> <time class="published dt-published" datetime="2016-08-31T00:00:00+02:00" title="2016-08-31 00:00">2016-08-31 00:00</time>
            
                |   <i class="fa fa-comment"></i>         <a href="posts/using-enums-in-c-sharp/#disqus_thread" data-disqus-identifier="cache/posts/using-enums-in-c-sharp.html">Comments</a>


            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>
Recently Steve Smith posted an article named <a href="http://ardalis.com/enum-alternatives-in-c">Enum Alternatives in C#</a> where he points out that <a href="https://msdn.microsoft.com/en-us/library/sbbt4032.aspx">C# enums</a> are nothing more than
</p>
<blockquote>
<p>
simple value-type flags that provide very minimal protection from invalid values and no behavior
</p>
</blockquote>
<p>
In the same article he mentiones <a href="http://blog.falafel.com/introducing-type-safe-enum-pattern/">type safe enum pattern</a> as a better alternative to enums due to type safety. As a conclusion, Steve suggests that instead of using and declaring enums in the classical way
</p>
<div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="n">WeekDay</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Monday</span><span class="p">,</span>
<span class="w">    </span><span class="n">Tuesday</span><span class="p">,</span>
<span class="w">    </span><span class="n">Wednesday</span><span class="p">,</span>
<span class="w">    </span><span class="n">Thursday</span><span class="p">,</span>
<span class="w">    </span><span class="n">Friday</span><span class="p">,</span>
<span class="w">    </span><span class="n">Saturday</span><span class="p">,</span>
<span class="w">    </span><span class="n">Sunday</span>
<span class="p">}</span>
</pre></div>
<p>
we should declare them in a <code>type safe</code> manner like this:
</p>
<div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">WeekDay</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">WeekDay</span><span class="w"> </span><span class="n">Monday</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WeekDay</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">Resources</span><span class="p">.</span><span class="n">Monday</span><span class="p">);</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">WeekDay</span><span class="w"> </span><span class="n">Tuesday</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WeekDay</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Resources</span><span class="p">.</span><span class="n">Tuesday</span><span class="p">);</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">WeekDay</span><span class="w"> </span><span class="n">Wednesday</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WeekDay</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">Resources</span><span class="p">.</span><span class="n">Wednesday</span><span class="p">);</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">WeekDay</span><span class="w"> </span><span class="n">Thursday</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WeekDay</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">Resources</span><span class="p">.</span><span class="n">Thursday</span><span class="p">);</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">WeekDay</span><span class="w"> </span><span class="n">Friday</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WeekDay</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">Resources</span><span class="p">.</span><span class="n">Friday</span><span class="p">);</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">WeekDay</span><span class="w"> </span><span class="n">Saturday</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WeekDay</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">Resources</span><span class="p">.</span><span class="n">Saturday</span><span class="p">);</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">WeekDay</span><span class="w"> </span><span class="n">Sunday</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WeekDay</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="n">Resources</span><span class="p">.</span><span class="n">Sunday</span><span class="p">);</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="nf">WeekDay</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="k">value</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">value</span><span class="p">;</span>
<span class="w">        </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Value</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>
This way the <a href="https://msdn.microsoft.com/en-us/library/06tc147t.aspx"><code>switch</code></a> we all know and love (<b>not</b>) on the values of <code>WeekDay</code> will remain the same. Although this is a very elegant way of solving the issue of someone calling <code>themeSelector.GetTheme((WeekDay)13)</code> without getting an error from the compiler there are some issues with <code>type safe enums</code>:
</p>
<ul class="org-ul">
<li>First of all, <code>type safe enums</code> are <code>nullable</code> which means that now we can call <code>themeSelector.GetTheme(null)</code> and that would be a valid call which will most probably throw a <code>NullReferenceException</code> when executed.</li>
<li>Second, <code>type safe enums</code> cannot represent <a href="https://msdn.microsoft.com/en-us/library/system.flagsattribute(v=vs.110).aspx#Anchor_7">flags</a> easily; they <i>can</i> by enumerating all possible values but that may not be an easy task for large <code>enums</code>.</li>
</ul>
<p>
However, the problems the article refers to are not in the lack of compiler checks for valid <code>enum</code> values but rather how the <code>enum</code> values are used.
</p>
<div id="outline-container-orgd321cd8" class="outline-2">
<h2 id="orgd321cd8">Displaying <code>enums</code> in UI elements</h2>
<div class="outline-text-2" id="text-orgd321cd8">
<p>
Let's look at the simplest problem Steve mentiones - displaying <code>enum</code> values in the UI. Indeed using the <code>DescriptionAttribute</code> is not the best solution you can have.
</p>

<p>
The biggest grudge <b>I</b> have with <code>DescriptionAttribute</code> is that it doesn't play nice with applications that have to support multiple languages. However, for the past few years (basically since <code>extension methods</code> were added to .NET Framework) I've taken another approach on displaying <code>enum</code> values in the UI.
</p>

<p>
The idea behind this is simple - build a <code>Dictionary&lt;TEnum, string&gt;</code> where the keys are <code>enum</code> values and values are localized strings taken from a resource file and bind the results to whatever control is used to display the <code>enum</code>. And for that I use a single <code>extension method</code>:
</p>
<div class="highlight"><pre><span></span><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">EnumUtils</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">      </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">Dictionary</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GetLocalizedEnumValues</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="w"> </span><span class="n">ResourceManager</span><span class="w"> </span><span class="n">resourceManager</span><span class="p">)</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="n">Enum</span><span class="p">.</span><span class="n">GetValues</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">))</span>
<span class="w">              </span><span class="p">.</span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">              </span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">val</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span><span class="p">,</span><span class="w"> </span><span class="n">Text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resourceManager</span><span class="p">.</span><span class="n">GetString</span><span class="p">(</span><span class="n">val</span><span class="p">.</span><span class="n">ToString</span><span class="p">())</span><span class="w"> </span><span class="p">})</span>
<span class="w">              </span><span class="p">.</span><span class="n">ToDictionary</span><span class="p">(</span><span class="n">kvp</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">kvp</span><span class="p">.</span><span class="n">Value</span><span class="p">,</span><span class="w"> </span><span class="n">kvp</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">kvp</span><span class="p">.</span><span class="n">Text</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
<p>
Of course, this method relies on a convention that the resource file must have entries for each <code>enum</code> value in order for it to work but when working with applications that support multiple languages there is seldom a case when something that needs to be displayed in the UI is not localized.
</p>

<p>
And now let's look at how this method can be used to localize <code>enum</code> values; as the example platform let's consider <code>ASP.NET MVC</code>:
</p>
<div class="highlight"><pre><span></span><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ThemeController</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Controller</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">      </span><span class="k">public</span><span class="w"> </span><span class="n">ActionResult</span><span class="w"> </span><span class="nf">Index</span><span class="p">()</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">          </span><span class="kt">var</span><span class="w"> </span><span class="n">viewModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ThemeViewModel</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">              </span><span class="n">WeekDays</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Resources</span><span class="p">.</span><span class="n">ResourceManager</span><span class="p">.</span><span class="n">GetLocalizedEnumValues</span><span class="o">&lt;</span><span class="n">WeekDay</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">                  </span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">kvp</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SelectListItem</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kvp</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span><span class="w"> </span><span class="n">Text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kvp</span><span class="p">.</span><span class="n">Value</span><span class="p">})</span>
<span class="w">          </span><span class="p">};</span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="nf">View</span><span class="p">(</span><span class="n">viewModel</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
<p>
Granted, it's more work to do in order to display <code>enums</code> like this but there are advantages:
</p>
<ul class="org-ul">
<li>
<b>No magic strings</b> are involved compared to using <code>DescriptionAttribute</code>
</li>
<li>You have to do <b>less repetitive work</b>. If you declare your <code>enum</code> in a <code>type safe</code> manner you'll have the tedious task of pairing each <code>enum</code> value with its (localized) description by hand; <code>GetlocalizedEnumValues</code> method will do that automatically for all enums which have entries in the resources file.</li>
</ul>
</div>
</div>
<div id="outline-container-org24137e8" class="outline-2">
<h2 id="org24137e8">Use defensive coding in <code>switch</code> statements</h2>
<div class="outline-text-2" id="text-org24137e8">
<p>
Now, let's address the bigger issue when dealing with <code>enums</code>, namely calling (in our case) <code>themeSelector.GetTheme((WeekDay)13)</code>. The problem here is that a lot of developers don't use defensive programming when dealing with <code>enums</code> (or at all).
</p>

<p>
Let's consider how our <code>GetTheme</code> method would look like in a non-defensive style and to emphasize things let's look at the worst-case scenario:
</p>
<div class="highlight"><pre><span></span><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ThemeSelector</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">      </span><span class="k">public</span><span class="w"> </span><span class="n">Theme</span><span class="w"> </span><span class="nf">GetTheme</span><span class="p">(</span><span class="n">WeekDay</span><span class="w"> </span><span class="n">weekDay</span><span class="p">)</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">          </span><span class="k">switch</span><span class="p">(</span><span class="n">weekDay</span><span class="p">)</span>
<span class="w">              </span><span class="k">case</span><span class="w"> </span><span class="n">WeekDay</span><span class="p">.</span><span class="n">Monday</span><span class="p">:</span>
<span class="w">                  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Theme</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Playlist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Monday mood"</span><span class="w"> </span><span class="p">};</span>
<span class="w">              </span><span class="k">case</span><span class="w"> </span><span class="n">WeekDay</span><span class="p">.</span><span class="n">Tuesday</span><span class="p">:</span>
<span class="w">                  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Theme</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Playlist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Four more days to Friday"</span><span class="w"> </span><span class="p">};</span>
<span class="w">              </span><span class="k">case</span><span class="w"> </span><span class="n">WeekDay</span><span class="p">.</span><span class="n">Wednesday</span><span class="p">:</span>
<span class="w">                  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Theme</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Playlist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"It's hump day already!"</span><span class="w"> </span><span class="p">};</span>
<span class="w">              </span><span class="k">case</span><span class="w"> </span><span class="n">WeekDay</span><span class="p">.</span><span class="n">Thursday</span><span class="p">:</span>
<span class="w">                  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Theme</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Playlist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"One more day!"</span><span class="w"> </span><span class="p">};</span>
<span class="w">              </span><span class="k">case</span><span class="w"> </span><span class="n">WeekDay</span><span class="p">.</span><span class="n">Friday</span><span class="p">:</span>
<span class="w">                  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Theme</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Playlist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Friday margueritas!"</span><span class="w"> </span><span class="p">};</span>
<span class="w">              </span><span class="k">case</span><span class="w"> </span><span class="n">WeekDay</span><span class="p">.</span><span class="n">Saturday</span><span class="p">:</span>
<span class="w">                  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Theme</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Playlist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Go away hangover!"</span><span class="w"> </span><span class="p">};</span>
<span class="w">              </span><span class="k">case</span><span class="w"> </span><span class="n">WeekDay</span><span class="p">.</span><span class="n">Sunday</span><span class="p">:</span>
<span class="w">              </span><span class="k">default</span><span class="p">:</span><span class="w"> </span><span class="c1">// BAD!!!</span>
<span class="w">                  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Theme</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Playlist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"There's still time to party!"</span><span class="w"> </span><span class="p">};</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
<p>
See the problem there? The developer <b>assumes that the method will always receive a valid value</b> thus he/she links the <code>default</code> case with an existing label instead of checking the value.
</p>

<p>
The simplest fix for this is below:
</p>
<div class="highlight"><pre><span></span><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ThemeSelector</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">      </span><span class="k">public</span><span class="w"> </span><span class="n">Theme</span><span class="w"> </span><span class="nf">GetTheme</span><span class="p">(</span><span class="n">WeekDay</span><span class="w"> </span><span class="n">weekDay</span><span class="p">)</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">          </span><span class="k">switch</span><span class="p">(</span><span class="n">weekDay</span><span class="p">)</span>
<span class="w">              </span><span class="k">case</span><span class="w"> </span><span class="n">WeekDay</span><span class="p">.</span><span class="n">Monday</span><span class="p">:</span>
<span class="w">                  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Theme</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Playlist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Monday mood"</span><span class="w"> </span><span class="p">};</span>
<span class="w">              </span><span class="k">case</span><span class="w"> </span><span class="n">WeekDay</span><span class="p">.</span><span class="n">Tuesday</span><span class="p">:</span>
<span class="w">                  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Theme</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Playlist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Four more days to Friday"</span><span class="w"> </span><span class="p">};</span>
<span class="w">              </span><span class="k">case</span><span class="w"> </span><span class="n">WeekDay</span><span class="p">.</span><span class="n">Wednesday</span><span class="p">:</span>
<span class="w">                  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Theme</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Playlist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"It's hump day already!"</span><span class="w"> </span><span class="p">};</span>
<span class="w">              </span><span class="k">case</span><span class="w"> </span><span class="n">WeekDay</span><span class="p">.</span><span class="n">Thursday</span><span class="p">:</span>
<span class="w">                  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Theme</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Playlist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"One more day!"</span><span class="w"> </span><span class="p">};</span>
<span class="w">              </span><span class="k">case</span><span class="w"> </span><span class="n">WeekDay</span><span class="p">.</span><span class="n">Friday</span><span class="p">:</span>
<span class="w">                  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Theme</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Playlist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Friday margueritas!"</span><span class="w"> </span><span class="p">};</span>
<span class="w">              </span><span class="k">case</span><span class="w"> </span><span class="n">WeekDay</span><span class="p">.</span><span class="n">Saturday</span><span class="p">:</span>
<span class="w">                  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Theme</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Playlist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Go away hangover!"</span><span class="w"> </span><span class="p">};</span>
<span class="w">              </span><span class="k">case</span><span class="w"> </span><span class="n">WeekDay</span><span class="p">.</span><span class="n">Sunday</span><span class="p">:</span>
<span class="w">                  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Theme</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Playlist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"There's still time to party!"</span><span class="w"> </span><span class="p">};</span>
<span class="w">              </span><span class="k">default</span><span class="p">:</span>
<span class="w">                  </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">ArgumentException</span><span class="p">(</span><span class="s">"Invalid value for WeekDay enum."</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
<p>
Throwing the <code>ArgumentException</code> when receiving an invalid value will crash the application but this crash gives us at least two benefits:
</p>
<ul class="org-ul">
<li>The application behavior becomes predictable: <code>GetTheme</code> method will either return a valid <code>Theme</code> or will throw an error</li>
<li>It makes debugging <b>a lot</b> easier; you know the point of failure, you know the reason and you have the full stack trace. When the application crashes twenty steps after receiving the invalid value there are a lot more unknows to <b>why</b> the application crashed and it may be harder to reproduce the problem.</li>
</ul>
</div>
</div>
<div id="outline-container-orgaea7954" class="outline-2">
<h2 id="orgaea7954">Use specialzed <code>builders</code> instead of <code>switch</code> statements</h2>
<div class="outline-text-2" id="text-orgaea7954">
<p>
However, the best way to use <code>switch</code> statements is to avoid it altoghether. Why? Mainly because <code>switch</code> statements are the main violators of <a href="https://en.wikipedia.org/wiki/Open/closed_principle">Open/Closed Principle</a> i.e.every time a new member of the enum is added, every <code>switch</code> on that enum values needs to be changed in order to accomodate the new member (except for the cases that use the <code>default</code> label).
</p>

<p>
In such cases I prefer to use something that I call <code>specialized builders</code> to avoid the switch statement.
</p>

<p>
The ideea is simple: the logic behind each label of the <code>switch</code> statement is refactored into a separate class which implements a common interface for all the labels. The same interface exposes a property of the enum type which tells the clients of the interface which enum value it can process. The client code receives as a dependency a collection of such instances and instead of a switch statement it just iterates through the collection to find the suitable instance.
</p>

<p>
Let's exemplify using our scenario; instead of having the <code>switch</code> statement inside the <code>GetTheme</code> method from the previous example, let's refactor each labels logic into a separate class. But before that, let's define an interface that will be implemented by all the classes.
</p>

<p>
Since the switch is used to build instances of <code>Theme</code> class, let's call the interface <code>IThemeBuilder</code>; here is it's definition:
</p>
<div class="highlight"><pre><span></span><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IThemeBuilder</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">      </span><span class="n">WeekDay</span><span class="w"> </span><span class="n">WeekDay</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">      </span><span class="n">Theme</span><span class="w"> </span><span class="nf">BuildTheme</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
<p>
Now an implementation of this interface for <code>WeekDay.Monday</code> would look like this:
</p>
<div class="highlight"><pre><span></span><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">MondayThemeBuilder</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">      </span><span class="k">public</span><span class="w"> </span><span class="n">WeekDay</span><span class="w"> </span><span class="n">WeekDay</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">          </span><span class="k">get</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">WeekDay</span><span class="p">.</span><span class="n">Monday</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="k">public</span><span class="w"> </span><span class="n">Theme</span><span class="w"> </span><span class="nf">BuildTheme</span><span class="p">()</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Theme</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Playlist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Monday mood"</span><span class="w"> </span><span class="p">};</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
<p>
With all the implementations in place, all it remains to do is to register the implementations of <code>IThemeBuilder</code> interface in the <a href="http://en.wikipedia.org/wiki/Dependency_injection">DI</a> container and inject them into the <code>ThemeSelector</code> class. The <code>GetTheme</code> method now becomes an iteration to find a suitable <code>builder</code> for the argument received. If no such instance is found, an exception is thrown to signal the error.
</p>
<div class="highlight"><pre><span></span><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ThemeSelector</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">      </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="n">ThemeBuilder</span><span class="o">&gt;</span><span class="w"> </span><span class="n">builders</span><span class="p">;</span>

<span class="w">      </span><span class="k">public</span><span class="w"> </span><span class="nf">ThemeSelector</span><span class="p">(</span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="n">IThemeBuilder</span><span class="o">&gt;</span><span class="w"> </span><span class="n">themeBuilders</span><span class="p">)</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">          </span><span class="n">builders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">themeBuilders</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="k">public</span><span class="w"> </span><span class="n">Theme</span><span class="w"> </span><span class="nf">GetTheme</span><span class="p">(</span><span class="n">WeekDay</span><span class="w"> </span><span class="n">weekDay</span><span class="p">)</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">          </span><span class="kt">var</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builders</span><span class="p">.</span><span class="n">SingleOrDefault</span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">WeekDay</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">weekDay</span><span class="p">);</span>
<span class="w">          </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">              </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">ArgumentException</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">"Invalid value '{0}' received for week day."</span><span class="p">,</span><span class="w"> </span><span class="n">weekDay</span><span class="p">));</span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">BuildTheme</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
<p>
Now everytime a new member needs to be added to <code>WeekDay</code> enum, although not the case here, there are at most three changes to make to accomodate the new value:
</p>
<ol class="org-ol">
<li>Add the new value to the <code>enum</code>
</li>
<li>Create a new class that will implement <code>IThemeBuilder</code> for the new value</li>
<li>Register the new class in the <code>DI container</code>
</li>
</ol>
<p>
Depending on which <code>dependency injection</code> library you use, there may be no change required for registering the new class in the container.
</p>
</div>
</div>
<div id="outline-container-org4d1f290" class="outline-2">
<h2 id="org4d1f290">Conclusions</h2>
<div class="outline-text-2" id="text-org4d1f290">
<p>
The main conclusion of the article is that <b><code>enums</code> aren't bad they're just improperly used</b>. Sometimes creating a thick class to represent <code>type safe enums</code> may be suitable for your scenario but most of the time it's not worth the effort. Instead, you should concentrate more on the places in code where the <code>enum</code> is used to make them safer, more clean and elegant.
</p>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/abstraction-is-not-a-principle-of-object-oriented-programming/" class="u-url">Abstraction is not a principle of Object Oriented Programming</a></h1>
        <div class="metadata">
            <p class="dateline">
              <i class="fa fa-clock-o"></i> <time class="published dt-published" datetime="2016-07-29T00:00:00+02:00" title="2016-07-29 00:00">2016-07-29 00:00</time>
            
                |   <i class="fa fa-comment"></i>         <a href="posts/abstraction-is-not-a-principle-of-object-oriented-programming/#disqus_thread" data-disqus-identifier="cache/posts/abstraction-is-not-a-principle-of-object-oriented-programming.html">Comments</a>


            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-orgc80827b" class="outline-2">
<h2 id="orgc80827b">TL;DR</h2>
<div class="outline-text-2" id="text-orgc80827b">
<p>
<code>Abstraction</code> is a core concept in programming and not a principle that is <b>solely</b> applicable in OOP, because <b>programming is all about dealing with an abstract representation of the business model (application space)</b>.
</p>
</div>
</div>
<div id="outline-container-org8ee4809" class="outline-2">
<h2 id="org8ee4809">Abstraction is an overall programming principle</h2>
<div class="outline-text-2" id="text-org8ee4809">
<p>
There are a lot of articles saying that OOP has four principles:
</p>
<ul class="org-ul">
<li><code>Encapsulation</code></li>
<li><code>Inheritance</code></li>
<li><code>Polymorphism</code></li>
<li><code>Abstraction</code></li>
</ul>
<p>
But if we do a web searh for <i>what is abstraction?</i> we get more or less the same definition as the one from <a href="http://whatis.techtarget.com/definition/abstraction">here</a>.
</p>
<blockquote>
<p>
Abstraction (from the Latin abs, meaning away from and trahere, meaning to draw) is the process of taking away or removing characteristics from something in order to reduce it to a set of essential characteristics.
</p>
</blockquote>
<p>
Although the article defines <code>abstraction</code> in an OOP context, <i><code>abstraction</code> is actually a an overall programming principle</i>.
</p>

<p>
Why? Because programming means modeling entities and interactions of an <i>abstract representation of the business model</i>. And since there are several programming paradigms all of which are used to represent a set of specific business models all of those paradigms use <code>abstraction</code> to succeed in that representation.
</p>
</div>
</div>
<div id="outline-container-orgc93faba" class="outline-2">
<h2 id="orgc93faba">An example of <code>abstraction</code> in OOP</h2>
<div class="outline-text-2" id="text-orgc93faba">
<p>
To better clarify what <code>abstraction</code> is (in OOP) let's consider a trivial example: A <code>StudentRegistrationController</code> (ASP.NET MVC) needs to save the data from a registration form (<code>Student</code>) into some sort of database represented by an instance of <code>IStudentDataStore</code>.
</p>

<p>
For the sake of brevity let's say that <code>IStudentDataStore</code> interface has the following definition:
</p>
<div class="highlight"><pre><span></span><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IStudentDataStore</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">      </span><span class="k">void</span><span class="w"> </span><span class="nf">Save</span><span class="p">(</span><span class="n">Student</span><span class="w"> </span><span class="n">student</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
<p>
With that in mind, the code for the example above would look like this:
</p>
<div class="highlight"><pre><span></span><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Student</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">      </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">FirstName</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">      </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">LastName</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">      </span><span class="k">public</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="n">DateOfBirth</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">      </span><span class="k">public</span><span class="w"> </span><span class="n">Gender</span><span class="w"> </span><span class="n">Gender</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">      </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Email</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">      </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">PhoneNumber</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">StudentRegistrationController</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Controller</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">      </span><span class="k">public</span><span class="w"> </span><span class="nf">StudentRegistrationController</span><span class="p">(</span><span class="n">IStudentDataStore</span><span class="w"> </span><span class="n">dataStore</span><span class="p">)</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">          </span><span class="n">_dataStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataStore</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="k">public</span><span class="w"> </span><span class="n">ActionResult</span><span class="w"> </span><span class="nf">Save</span><span class="p">(</span><span class="n">Student</span><span class="w"> </span><span class="n">viewModel</span><span class="p">)</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">          </span><span class="c1">// Validation ommited for brevity</span>
<span class="w">          </span><span class="n">_dataStore</span><span class="p">.</span><span class="n">Save</span><span class="p">(</span><span class="n">viewModel</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
<p>
As we can see from the code the <code>IStudentDataStore</code> abstracts the details of how <code>Student</code> data is persisted. The interface doesn't tell whether the data is persisted to a flat file, SQL Database, NoSQL database or other media. As long as we have an implementation of <code>IStudentDataStore</code> the controller works just fine.
</p>

<p>
But is this <code>abstraction</code> technique available <i>only</i> in OOP paradigm? The answer is <b>no</b>. The same thing, although in a different form can be used in other paradigms. To demonstrate so, let's use <a href="https://en.wikipedia.org/wiki/Lisp_(programming_language)">lisp</a> as a programming language and let's see how <i>abstraction</i> works in a <b>functional programming paradigm</b>.
</p>
</div>
</div>
<div id="outline-container-orgf63fc95" class="outline-2">
<h2 id="orgf63fc95">The same example of <code>abstraction</code> in functional programming</h2>
<div class="outline-text-2" id="text-orgf63fc95">
<p>
To see how the same thing would be written in a functional style let's first see what are the entities from the previous example and how those entities interact between them:
</p>
<ul class="org-ul">
<li>
<code>StudentRegistrationController</code>
<ul class="org-ul">
<li>Is the top-most entity</li>
<li>Has an <code>IStudentDataStore</code> on which calls the <code>Save</code> method</li>
</ul>
</li>
<li>
<code>IStudentDataStore</code>
<ul class="org-ul">
<li>Defines a contract between the controller and the underlying data store</li>
</ul>
</li>
<li>
<code>Student</code>
<ul class="org-ul">
<li>Is a data contract, i.e. encapsulates all the properties of a student into a single entity</li>
</ul>
</li>
</ul>
<p>
Having the above and knowing that in functional programming <i>everything is a function</i> we replace every <i>entity</i> with a <i>function</i>:
</p>
<ul class="org-ul">
<li>We'll create a top-level function named <code>save-student</code>; it will have the following parameters:
<ul class="org-ul">
<li>
<code>student-info</code> -&gt; a hash map containing the data contract</li>
<li>
<code>persist-func</code> -&gt; a function that will be called to save the data to a data store</li>
</ul>
</li>
<li>Another two functions <code>persist-student-info-to-file</code> and <code>persist-student-info-in-memory</code> will encapsulate the logic of persisting data to a data store.</li>
</ul>
<p>
Note that both functions have the same signature. The parameters of these functions represent the data contract.
</p>
<div class="highlight"><pre><span></span><span class="w">  </span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">persist-student-info-to-file</span><span class="w"> </span><span class="p">(</span><span class="nv">first-name</span><span class="w"> </span><span class="nv">last-name</span><span class="w"> </span><span class="nv">dob</span><span class="w"> </span><span class="nv">gender</span><span class="w"> </span><span class="nv">email</span><span class="w"> </span><span class="nv">phone</span><span class="p">)</span>
<span class="w">    </span><span class="c1">;; Writes the info as a new line into the file specified by *database-location*</span>
<span class="w">    </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nc">stream</span><span class="w"> </span><span class="p">(</span><span class="nb">open</span><span class="w"> </span><span class="vg">*database-location*</span>
<span class="w">                </span><span class="ss">:direction</span><span class="w"> </span><span class="ss">:output</span>
<span class="w">                </span><span class="ss">:if-exists</span><span class="w"> </span><span class="ss">:append</span><span class="p">)))</span>
<span class="w">      </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="nc">stream</span><span class="w"> </span><span class="s">"~s|~s|~s|~s|~s|~s"</span>
<span class="w">          </span><span class="nv">first-name</span>
<span class="w">          </span><span class="nv">last-name</span>
<span class="w">          </span><span class="nv">dob</span>
<span class="w">          </span><span class="nv">gender</span>
<span class="w">          </span><span class="nv">email</span>
<span class="w">          </span><span class="nv">phone</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="nb">close</span><span class="w"> </span><span class="nc">stream</span><span class="p">)))</span>


<span class="w">  </span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">persist-student-info-in-memory</span><span class="w"> </span><span class="p">(</span><span class="nv">first-name</span><span class="w"> </span><span class="nv">last-name</span><span class="w"> </span><span class="nv">dob</span><span class="w"> </span><span class="nv">gender</span><span class="w"> </span><span class="nv">email</span><span class="w"> </span><span class="nv">phone</span><span class="p">)</span>
<span class="w">    </span><span class="c1">;; Persists student data into an in-memory data store named *all-students*</span>
<span class="w">    </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">student-id</span><span class="w"> </span><span class="p">(</span><span class="nb">list-length</span><span class="w"> </span><span class="vg">*all-students*</span><span class="p">)))</span>
<span class="w">      </span><span class="p">(</span><span class="k">setq</span><span class="w"> </span><span class="vg">*all-students*</span>
<span class="w">        </span><span class="p">(</span><span class="nb">append</span><span class="w"> </span><span class="vg">*all-students*</span>
<span class="w">            </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="nv">student-id</span><span class="w"> </span><span class="nv">first-name</span><span class="w"> </span><span class="nv">last-name</span><span class="w"> </span><span class="nv">dob</span><span class="w"> </span><span class="nv">gender</span><span class="w"> </span><span class="nv">email</span><span class="w"> </span><span class="nv">phone</span><span class="p">)))))</span>

<span class="w">  </span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">save-student</span><span class="w"> </span><span class="p">(</span><span class="nv">student-info</span><span class="w"> </span><span class="nv">persist-func</span><span class="p">)</span>
<span class="w">    </span><span class="c1">;; Saves student data to a persistent store</span>
<span class="w">    </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">first-name</span><span class="w"> </span><span class="p">(</span><span class="nb">gethash</span><span class="w"> </span><span class="ss">'first-name</span><span class="w"> </span><span class="nv">student-info</span><span class="p">))</span>
<span class="w">          </span><span class="p">(</span><span class="nv">last-name</span><span class="w"> </span><span class="p">(</span><span class="nb">gethash</span><span class="w"> </span><span class="ss">'last-name</span><span class="w"> </span><span class="nv">student-info</span><span class="p">))</span>
<span class="w">          </span><span class="p">(</span><span class="nv">dob</span><span class="w"> </span><span class="p">(</span><span class="nb">gethash</span><span class="w"> </span><span class="ss">'date-of-birth</span><span class="w"> </span><span class="nv">student-info</span><span class="p">))</span>
<span class="w">          </span><span class="p">(</span><span class="nv">gender</span><span class="w"> </span><span class="p">(</span><span class="nb">gethash</span><span class="w"> </span><span class="ss">'gender</span><span class="w"> </span><span class="nv">student-info</span><span class="p">))</span>
<span class="w">          </span><span class="p">(</span><span class="nv">email</span><span class="w"> </span><span class="p">(</span><span class="nb">gethash</span><span class="w"> </span><span class="ss">'email</span><span class="w"> </span><span class="nv">student-info</span><span class="p">))</span>
<span class="w">          </span><span class="p">(</span><span class="nv">phone</span><span class="w"> </span><span class="p">(</span><span class="nb">gethash</span><span class="w"> </span><span class="ss">'phone-number</span><span class="w"> </span><span class="nv">student-info</span><span class="p">)))</span>
<span class="w">      </span><span class="p">(</span><span class="nb">funcall</span><span class="w"> </span><span class="nv">persist-func</span><span class="w"> </span><span class="nv">first-name</span><span class="w"> </span><span class="nv">last-name</span><span class="w"> </span><span class="nv">dob</span><span class="w"> </span><span class="nv">gender</span><span class="w"> </span><span class="nv">email</span><span class="w"> </span><span class="nv">phone</span><span class="p">)))</span>
</pre></div>
<p>
Having the definitions above we can achieve the same level of abstraction by putting everything together and defining global variables (think of it as poor mans <code>dependency injection</code>):
</p>
<div class="highlight"><pre><span></span><span class="w">  </span><span class="p">(</span><span class="nb">defparameter</span><span class="w"> </span><span class="vg">*database-location*</span><span class="w"> </span><span class="s">"/tmp/students"</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">defparameter</span><span class="w"> </span><span class="vg">*student-info*</span><span class="w"> </span><span class="p">(</span><span class="nb">make-hash-table</span><span class="p">))</span>

<span class="w">  </span><span class="p">(</span><span class="k">progn</span>
<span class="w">    </span><span class="p">(</span><span class="nb">setf</span><span class="w"> </span><span class="p">(</span><span class="nb">gethash</span><span class="w"> </span><span class="ss">'first-name</span><span class="w"> </span><span class="vg">*student-info*</span><span class="p">)</span><span class="w"> </span><span class="s">"John"</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nb">setf</span><span class="w"> </span><span class="p">(</span><span class="nb">gethash</span><span class="w"> </span><span class="ss">'last-name</span><span class="w"> </span><span class="vg">*student-info*</span><span class="p">)</span><span class="w"> </span><span class="s">"Doe"</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nb">setf</span><span class="w"> </span><span class="p">(</span><span class="nb">gethash</span><span class="w"> </span><span class="ss">'date-of-birth</span><span class="w"> </span><span class="nv">*student-info</span><span class="p">)</span><span class="w"> </span><span class="s">"2000-05-14"</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nb">setf</span><span class="w"> </span><span class="p">(</span><span class="nb">gethash</span><span class="w"> </span><span class="ss">'email</span><span class="w"> </span><span class="vg">*student-info*</span><span class="p">)</span><span class="w"> </span><span class="s">"john.doe@example.com"</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nb">setf</span><span class="w"> </span><span class="p">(</span><span class="nb">gethash</span><span class="w"> </span><span class="ss">'phone-number</span><span class="w"> </span><span class="vg">*student-info*</span><span class="p">)</span><span class="w"> </span><span class="s">"1234567981"</span><span class="p">))</span>

<span class="w">  </span><span class="p">(</span><span class="nv">save-student</span><span class="w"> </span><span class="vg">*student-info*</span><span class="w"> </span><span class="ss">'persist-student-info-to-file</span><span class="p">)</span>
</pre></div>
<p>
Et voilà! We have used <code>abstraction</code> in a functional style to remove the details of how the data is persisted thus showing that <code>abstraction</code> isn't a principle applicable only to object oriented programming.
</p>
</div>
</div>
<div id="outline-container-org6de851c" class="outline-2">
<h2 id="org6de851c">Acknowledgments</h2>
<div class="outline-text-2" id="text-org6de851c">
<p>
A big thank you to <a href="https://be.linkedin.com/in/ion-cojocaru-81b5a230">Ion Cojocaru</a> and <a href="https://ro.linkedin.com/in/florin-olariu-38615126">Florin Olariu</a> who reviewed this post before publication.
</p>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/fii-practic-2016/" class="u-url">FII Practic 2016</a></h1>
        <div class="metadata">
            <p class="dateline">
              <i class="fa fa-clock-o"></i> <time class="published dt-published" datetime="2016-04-08T00:00:00+02:00" title="2016-04-08 00:00">2016-04-08 00:00</time>
            
                |   <i class="fa fa-comment"></i>         <a href="posts/fii-practic-2016/#disqus_thread" data-disqus-identifier="cache/posts/fii-practic-2016.html">Comments</a>


            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-org348975c" class="outline-2">
<h2 id="org348975c">Programming principles</h2>
<div class="outline-text-2" id="text-org348975c">
</div>
<div id="outline-container-orgefa6310" class="outline-3">
<h3 id="orgefa6310">Chapter I - Object Oriented Programming</h3>
<div class="outline-text-3" id="text-orgefa6310">
</div>
<div id="outline-container-org209146d" class="outline-4">
<h4 id="org209146d">Encapsulation</h4>
<div class="outline-text-4" id="text-org209146d">
<blockquote>
<p>
<a href="https://en.wikipedia.org/wiki/Encapsulation_%2528computer_programming%2529">Encapsulation facilitates bundling of data with the method(s) operating on that data.</a>
</p>
</blockquote>

<p>
To exemplify let's consider the following requirement: <b>As an account holder I want to perform withdrawal and deposit of various amounts from and into my account</b>.
</p>

<p>
To implement the requirement we consider the following:
</p>
<ul class="org-ul">
<li>An <code>Account</code> has a <code>Balance</code>
</li>
<li>A <code>Withdrawal</code> is an operation which subtracts the <code>amount</code> from the <code>Balance</code>
</li>
<li>A <code>Deposit</code> is an operation which adds the <code>amount</code> to the <code>Balance</code>
</li>
</ul>
<p>
The code below should do it:
</p>
<div class="highlight"><pre><span></span><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Account</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="n">Balance</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Program</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Account</span><span class="p">();</span>
<span class="w">            </span><span class="c1">// Make a deposit</span>
<span class="w">            </span><span class="n">account</span><span class="p">.</span><span class="n">Balance</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">50</span><span class="p">;</span>
<span class="w">            </span><span class="c1">// Withdraw some cash</span>
<span class="w">            </span><span class="n">account</span><span class="p">.</span><span class="n">Balance</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>

<p>
<a href="https://en.wiktionary.org/wiki/Houston,_we_have_a_problem">Houston, we have a problem</a>. If we let the consumers of our code (in this case <code>Program</code>) to change the <code>Balance</code> at will, our system may end up in such funky situations where account holders can withdraw as much money as they want from the ATM without having enough funds.
</p>

<p>
    Of course, we need to validate each withdrawal but we can't surround each <code>account.Balance -= amount</code> with an <code>if(account.Balance &gt; amount)</code> because it's time consuming, inefficient
and we simply may not have access to the code that uses our class. What we <i>can</i> do is to <b>encapsulate</b> the withdrawal and validation into a single operation like this:
</p>
<div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Account</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="n">Balance</span><span class="w"> </span><span class="p">{</span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// The balance is now read-only</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="nf">Withdraw</span><span class="p">(</span><span class="n">Money</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">Balance</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">InvalidOperationException</span><span class="p">(</span><span class="s">"Insufficient funds."</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="n">Balance</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Deposit</span><span class="p">(</span><span class="n">Money</span><span class="w"> </span><span class="n">money</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="n">Balance</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">money</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Program</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Account</span><span class="p">();</span>
<span class="w">        </span><span class="n">account</span><span class="p">.</span><span class="n">Deposit</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
<span class="w">        </span><span class="n">account</span><span class="p">.</span><span class="n">Withdraw</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span><span class="w"> </span><span class="c1">// =&gt; InvalidOperationException.</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>
Much better! Now we are in control and we can be sure that <i>every</i> withdrawal is validated against account balance. As a nice side effect our code gains <a href="https://en.wikipedia.org/wiki/Computer_programming#Readability_of_source_code">readability</a>.
</p>
</div>
</div>
<div id="outline-container-orgefea58e" class="outline-4">
<h4 id="orgefea58e">Inheritance and Polymorphism</h4>
<div class="outline-text-4" id="text-orgefea58e">
<blockquote>
<p>
<a href="http://www.codeproject.com/Articles/22769/Introduction-to-Object-Oriented-Programming-Concep#Inheritance">Inheritance is the ability of a new class to acquire the properties of another class.</a>
</p>
</blockquote>

<p>
Let's look at another requirement:
</p>

<p>
<b>As an account holder I can have multiple accounts of various types such as savings account, debit account etc for which different withdrawal fees apply. For a debit account the withdrawal fee is zero; for a savings account the withdrawal fee is 0.5% of the amount withdrawn.</b>
</p>

<p>
From the requirement we can deduct that an <code>Account</code> can be modeled as a class with two properties - a <code>Balance</code> and a <code>Type</code> which can take values from an enumeration.
</p>

<p>
Also, additional changes to the <code>Withdraw</code> method should be applied:
</p>
<ul class="org-ul">
<li>Each withdrawal calculates and subtracts a fee from the balance</li>
<li>The check for insufficient funds should also take into the consideration the fee alongside the amount</li>
</ul>
<p>
Given the above, our code would look like this:
</p>
<div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="n">AccountType</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Debit</span><span class="p">,</span>
<span class="w">    </span><span class="n">Savings</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Account</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">AccountType</span><span class="w"> </span><span class="n">_accountType</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">Account</span><span class="p">(</span><span class="n">AccountType</span><span class="w"> </span><span class="n">accountType</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_accountType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accountType</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">AccountType</span><span class="w"> </span><span class="n">AccountType</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">_accountType</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="n">Balance</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Deposit</span><span class="p">(</span><span class="n">Money</span><span class="w"> </span><span class="n">money</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="n">Balance</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">money</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="nf">Withdraw</span><span class="p">(</span><span class="n">Money</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">fee</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CalculateWithdrawalFee</span><span class="p">(</span><span class="n">amount</span><span class="p">);</span>
<span class="w">        </span><span class="n">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fee</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">Balance</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">InvalidOperationException</span><span class="p">(</span><span class="s">"Insufficient funds."</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="n">Balance</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="nf">CalculateWithdrawalFee</span><span class="p">(</span><span class="n">Money</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_accountType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">AccountType</span><span class="p">.</span><span class="n">Savings</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">margin</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>
Everything looks good except the <a href="https://en.wikipedia.org/wiki/Magic_number_%2528programming%2529">magic numbers</a>. Until we get a new requirement:
</p>

<p>
<b>As an account holder I can have a credit account with a withdrawal fee of 0.7%</b>
</p>

<p>
To accomodate this new requirement we just have to change the <code>CalculateWithdrawalFee</code> method <b>and</b> add a new value in our <code>AccountType</code> enum:
</p>
<div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="n">AccountType</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Debit</span><span class="p">,</span>
<span class="w">    </span><span class="n">Savings</span><span class="p">,</span>
<span class="w">    </span><span class="n">Credit</span>
<span class="p">}</span>

<span class="p">...</span>

<span class="k">private</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="nf">CalculateWithdrawalFee</span><span class="p">(</span><span class="n">Money</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">switch</span><span class="p">(</span><span class="w"> </span><span class="n">_accountType</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="n">AccountType</span><span class="p">.</span><span class="n">Savings</span><span class="p">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="n">AccountType</span><span class="p">.</span><span class="n">Credit</span><span class="p">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.7</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="w">        </span><span class="k">default</span><span class="p">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>
The problem with this approach is that we had to add changes in more than one place; and the hint that this way of implementing the new requirement is not ok was given by the
<i>and</i> conjunction from the previous sentence. And if that wasn't enough then the <code>switch</code> should be the indicator of a possible code smell.
</p>

<p>
A better way to address these requirements is through inheritance by first determining which are the common traits of an <code>Account</code> and extracting them into a base class followed by modeling the specific behavior for each
subsequent type of account into its separate class.
</p>

<p>
So, as before, the common traits of an account are:
</p>
<ul class="org-ul">
<li>All accounts have a <code>Balance</code> property</li>
<li>All accounts support <code>Withdrawal</code> and <code>Deposit</code>
</li>
<li>All accounts validate available amount when a withdrawal is performed</li>
</ul>
<p>
The distinct traits of the accounts are:
</p>
<ul class="org-ul">
<li>Savings accounts have a withdrawal fee of 0.5% of the amount withdrawn</li>
<li>Credit accounts have a withdrawal fee of 0.7% of the amount withdrawn</li>
<li>Debit accounts don't have a withdrawal fee</li>
</ul>
<p>
Although we can see a clear difference between the common traits and specific features for each account type there is a certain amount of overlapping between them when performing a withdrawal.
In other words and specifically for withdrawal operation we can say that:
</p>
<ul class="org-ul">
<li>All account types support withdrawal</li>
<li>Each account type applies a specific withdrawal fee</li>
<li>All account types validate the amount against available funds</li>
</ul>
<p>
In order to model such kind of mixture between common and specific behavior we can make use of <code>polymorphism</code> by defining an abstract method <code>CalculateWithdrawalFee</code> which will be overridden
in the derived classes with specific values for each account type but still keeping the common behavior in a single place.
</p>
<blockquote>
<p>
<a href="http://www.codeproject.com/Articles/22769/Introduction-to-Object-Oriented-Programming-Concep#Polymorphism">Polymorphisms means the ability to request that the same operations be performed by a wide range of different types of things.</a>
</p>
</blockquote>
<p>
Now, with this approach let's address each requirement in the order they arrived. First, let's create the base class:
</p>
<div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Account</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="n">Balance</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Deposit</span><span class="p">(</span><span class="n">Money</span><span class="w"> </span><span class="n">money</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="n">Balance</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">money</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="nf">Withdraw</span><span class="p">(</span><span class="n">Money</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">fee</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CalculateWithdrawalFee</span><span class="p">(</span><span class="n">amount</span><span class="p">);</span>
<span class="w">        </span><span class="n">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fee</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">Balance</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">InvalidOperationException</span><span class="p">(</span><span class="s">"Insufficient funds."</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="n">Balance</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="nf">CalculateWithdrawalFee</span><span class="p">(</span><span class="n">Money</span><span class="w"> </span><span class="n">amount</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<p>
With the base class in place, let's model the first two account types - <i>debit</i> and <i>savings</i>:
</p>
<div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">DebitAccount</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Account</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="nf">CalculateWithdrawalFee</span><span class="p">(</span><span class="n">Money</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">SavingsAccount</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Account</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="nf">CalculateWithdrawalFee</span><span class="p">(</span><span class="n">Money</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>
With this structure in place adding a new account type is as simple as adding a new derived class and all edits are in a single place - the newly added file:
</p>
<div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">CreditAccount</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Account</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="nf">CalculateWithdrawalFee</span><span class="p">(</span><span class="n">Money</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.7</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div id="outline-container-org2949a0c" class="outline-3">
<h3 id="org2949a0c">Chapter II - Structure</h3>
<div class="outline-text-3" id="text-org2949a0c">
<p>
How you structure your code is very important in software development. A good code structure promotes <b>low coupling and high cohesion</b> which is a must for all good software.
</p>

<p>
Let's take a look at what <b>coupling</b> and <b>cohesion</b> mean.
</p>
</div>
<div id="outline-container-org04fb82c" class="outline-4">
<h4 id="org04fb82c">Low coupling - The case of the <code>Singleton</code>
</h4>
<div class="outline-text-4" id="text-org04fb82c">
<blockquote>
<p>
<a href="https://en.wikipedia.org/wiki/Coupling_%2528computer_programming%2529">Coupling is the manner and degree of interdependence between software modules; a measure of how closely connected two routines or modules are; the strength of the relationships between modules.</a>
</p>
</blockquote>
<p>
To exemplify what <b>low coupling</b> is and its importance let's take a look at the well-kown <code>Singleton</code> pattern:
</p>
<div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">FileSystem</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">FileSystem</span><span class="w"> </span><span class="n">_root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileSystem</span><span class="p">();</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="nf">FileSystem</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">FileSystem</span><span class="w"> </span><span class="n">Root</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">get</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">_root</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="nf">List</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Directory</span><span class="p">.</span><span class="n">EnumerateDirectories</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">Union</span><span class="p">(</span><span class="n">Directory</span><span class="p">.</span><span class="n">EnumerateFiles</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="n">ToArray</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Explorer</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">CurrentDirectory</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Contents</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">NavigateTo</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">contents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FileSystem</span><span class="p">.</span><span class="n">Root</span><span class="p">.</span><span class="n">List</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
<span class="w">        </span><span class="n">CurrentDirectory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">path</span><span class="p">;</span>
<span class="w">        </span><span class="n">Contents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">contents</span><span class="p">;</span>

<span class="w">        </span><span class="k">foreach</span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">contents</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">Display</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Program</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">explorer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Explorer</span><span class="p">();</span>
<span class="w">        </span><span class="n">explorer</span><span class="p">.</span><span class="n">NavigateTo</span><span class="p">(</span><span class="s">@"c:\users\petru\Documents\"</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>
What is wrong in the code above? <b>The <code>Explorer</code> class is tightly coupled with <code>FileSystem</code> singleton</b>, i.e. <code>Explorer</code> class is highly denendent on the <code>FileSystem</code> class and cannot be used without the <code>FileSystem</code>.
</p>

<p>
To demonstrate this <b>tight coupling</b> let's create a test for <code>Explorer</code> class to verify that it returns proper values from a known directory:
</p>
<div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ExplorerTests</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Directory</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="n">Explorer</span><span class="w"> </span><span class="n">Explorer</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;}</span>

<span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Initialize</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Explorer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Explorer</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="na">[TestClass]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">WhenNavigatingToTempDirectory</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ExplorerTests</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="na">[TestInitialize]</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">TestInitialize</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">Initialize</span><span class="p">();</span>
<span class="w">            </span><span class="n">Directory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">@"C:\Temp\"</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="na">[TestMethod]</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ShouldDisplayDirectoryContents</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">Explorer</span><span class="p">.</span><span class="n">NavigateTo</span><span class="p">(</span><span class="n">Directory</span><span class="p">);</span>
<span class="w">            </span><span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="n">Directory</span><span class="p">,</span><span class="w"> </span><span class="n">Explorer</span><span class="p">.</span><span class="n">CurrentDirectory</span><span class="p">);</span>
<span class="w">            </span><span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="s">"C:\Temp\test.txt"</span><span class="p">,</span><span class="w"> </span><span class="n">Explorer</span><span class="p">.</span><span class="n">Contents</span><span class="p">.</span><span class="n">Single</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>
This test may succeed on our machine because we know that there's a file named <code>text.txt</code> in our <code>C:\Temp\</code> directory because we've put it there. But what if we execute that test on another machine? Will that file be there?
</p>

<p>
Having such code means that not only our <code>Explorer</code> class is <b>tightly coupled</b> with the <code>FileSystem</code> class but also that this chain of dependency can grow to depend on the contents of the machine it's running on. We'll see how to break this dependecies in <b>Chapter III - SOLID code</b>.
</p>
</div>
</div>
<div id="outline-container-org1e14f08" class="outline-4">
<h4 id="org1e14f08">High cohesion - Why can't I have all code in <code>Program.cs</code>?</h4>
<div class="outline-text-4" id="text-org1e14f08">
<blockquote>
<p>
<a href="https://en.wikipedia.org/wiki/Cohesion_%2528computer_science%2529">Cohesion refers to the degree to which the elements of a module belong together.</a>
</p>
</blockquote>
<p>
The main reason for properly structuring your application is that <b>similar entities belong toghether</b>.
</p>

<p>
Let's consider the previous example in a less cohesive form:
</p>
<div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Program</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">NavigateTo</span><span class="p">(</span><span class="s">@"C:\users\petru\Documents\"</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">NavigateTo</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">contents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Directory</span><span class="p">.</span><span class="n">EnumerateDirectories</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">Union</span><span class="p">(</span><span class="n">Directory</span><span class="p">.</span><span class="n">EnumerateFiles</span><span class="p">(</span><span class="n">path</span><span class="p">));</span>
<span class="w">        </span><span class="k">foreach</span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">contents</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">Display</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>
In this case our <code>Program</code> is nothing more than a <a href="https://en.wikipedia.org/wiki/God_object"><b>God object</b></a> - it does <i>everything</i> and this is a problem. It may not be a problem for such a trivial application but when it comes to real applications things get more complicated.
</p>

<p>
Even small production applications have a lot of objects and that number keeps growing alongside the growth of the application and at some point having everything in one place is simply unbearable. Furthermore, chances are that more than one developer will be working on the same codebase and you can't just have everything in a single file.
</p>
</div>
</div>
</div>
<div id="outline-container-org1ce4451" class="outline-3">
<h3 id="org1ce4451">Chapter III - SOLID code</h3>
<div class="outline-text-3" id="text-org1ce4451">
</div>
<div id="outline-container-org822fc08" class="outline-4">
<h4 id="org822fc08">Single Responsibility Principle</h4>
<div class="outline-text-4" id="text-org822fc08">
<blockquote>
<p>
<a href="https://en.wikipedia.org/wiki/Single_responsibility_principle">Every module or class should have responsibility over a single part of the functionality provided by the software, and that responsibility should be entirely encapsulated by the class.</a>
</p>
</blockquote>
<p>
Let's look again at our Account example:
</p>
<div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Account</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="n">Balance</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Deposit</span><span class="p">(</span><span class="n">Money</span><span class="w"> </span><span class="n">money</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="n">Balance</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">money</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="nf">Withdraw</span><span class="p">(</span><span class="n">Money</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">fee</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CalculateWithdrawalFee</span><span class="p">(</span><span class="n">amount</span><span class="p">);</span>
<span class="w">        </span><span class="n">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fee</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">Balance</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">InvalidOperationException</span><span class="p">(</span><span class="s">"Insufficient funds."</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="n">Balance</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="nf">CalculateWithdrawalFee</span><span class="p">(</span><span class="n">Money</span><span class="w"> </span><span class="n">amount</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<p>
As you can see from the code, the <code>Withdraw</code> method does more than one thing, namely:
</p>
<ul class="org-ul">
<li>It calculates the withdrawal fee</li>
<li>It subtracts the amount and withdrawal fee from the balance</li>
</ul>
<p>
The purpose of this method is to withdraw the <code>amount</code> from the available balance; calculating the withdrawal fee should be someone else's responsibility. And that <i>someone else</i> should be a <code>WithdrawalAmountCalculator</code>:
</p>
<div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">WithdrawalAmountCalculator</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="nf">CalculateWithdrawalAmount</span><span class="p">(</span><span class="n">Money</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">percentage</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">percentage</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>
Now, let's put it all together and remove the extra responsibilities from <code>Account</code> class:
</p>
<div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">WithdrawalAmountCalculator</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="nf">CalculateWithdrawalAmount</span><span class="p">(</span><span class="n">Money</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">feePercentage</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">feePercentage</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Account</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">WithdrawalAmountCalculator</span><span class="w"> </span><span class="n">_amountCalculator</span><span class="p">;</span>

<span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="nf">Account</span><span class="p">(</span><span class="n">WithdrawalFeeCalculator</span><span class="w"> </span><span class="n">amountCalculator</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_amountCalculator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">amountCalculator</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="n">Balance</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">WithdrawalInterestRate</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Deposit</span><span class="p">(</span><span class="n">Money</span><span class="w"> </span><span class="n">money</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="n">Balance</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">money</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="nf">Withdraw</span><span class="p">(</span><span class="n">Money</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">amountToWithdraw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_amountCalculator</span><span class="p">.</span><span class="n">CalculateWithdrawalAmount</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="n">WithdrawalInterestRate</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">Balance</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">amountToWithdraw</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">InvalidOperationException</span><span class="p">(</span><span class="s">"Insufficient funds."</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="n">Balance</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">amountToWithdraw</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">DebitAccount</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Account</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">DebitAccount</span><span class="p">(</span><span class="n">WithdrawalAmountCalculator</span><span class="w"> </span><span class="n">amountCalculator</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">base</span><span class="p">(</span><span class="n">amountCalculator</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">WithdrawalInterestRate</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mf">0m</span><span class="p">;</span><span class="w"> </span><span class="p">}}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Program</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">calculator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WithdrawalAmountCalculator</span><span class="p">();</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DebitAccount</span><span class="p">(</span><span class="n">calculator</span><span class="p">);</span>
<span class="w">        </span><span class="n">account</span><span class="p">.</span><span class="n">Deposit</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Money</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">cash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">account</span><span class="p">.</span><span class="n">Withdraw</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>
Much better! Each class does only one thing, namely:
</p>
<ul class="org-ul">
<li>
<code>WithdrawalAmountCalculator</code> calculates the withdrawal amount and</li>
<li>
<code>Account</code> handles the changes to balance.</li>
</ul>
</div>
</div>
<div id="outline-container-org6336762" class="outline-4">
<h4 id="org6336762">Open/Closed principle</h4>
<div class="outline-text-4" id="text-org6336762">
<blockquote>
<p>
<a href="https://en.wikipedia.org/wiki/Open/closed_principle">Software entities (classes, modules, functions, etc.) should be open for extension, but closed for modification</a>
</p>
</blockquote>
<p>
Let's go back again to a previous example, the one with multiple account types:
</p>
<div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="n">AccountType</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Debit</span><span class="p">,</span>
<span class="w">    </span><span class="n">Savings</span><span class="p">,</span>
<span class="w">    </span><span class="n">Credit</span>
<span class="p">}</span>

<span class="p">...</span>

<span class="k">private</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="nf">CalculateWithdrawalFee</span><span class="p">(</span><span class="n">Money</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">switch</span><span class="p">(</span><span class="w"> </span><span class="n">_accountType</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="n">AccountType</span><span class="p">.</span><span class="n">Savings</span><span class="p">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="n">AccountType</span><span class="p">.</span><span class="n">Credit</span><span class="p">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.7</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="w">        </span><span class="k">default</span><span class="p">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>
The code from the example above is the exact opposite of <b>Open/Closed principle</b>:
</p>
<ul class="org-ul">
<li>It is <i>open for modification</i> because every time we'll need to create a new account type we'll have to add another <code>case</code> to the <code>switch</code> statement within <code>CalculateWithdrawalAmount</code> method</li>
<li>It is <i>closed for extension</i> in the sense that even if we do create a derived type of <code>Account</code> that type will have to <b>always</b> take into consideration the <code>AccountType</code> property when implementing its custom behavior.</li>
</ul>
</div>
</div>
<div id="outline-container-org21de9c9" class="outline-4">
<h4 id="org21de9c9">Liskov substitution principle</h4>
<div class="outline-text-4" id="text-org21de9c9">
<blockquote>
<p>
<a href="https://en.wikipedia.org/wiki/Liskov_substitution_principle">Objects in a program should be replaceable with instances of their subtypes without altering the correctness of that program.</a>
</p>
</blockquote>
<p>
To exemplify let's consider the overused <code>Rectangle</code> and <code>Square</code> example where one would model the relationship between them using the following statement: <b>a <code>Square</code> is a <code>Rectangle</code> having <code>Width == Height</code></b> as behavioral description. In other words, <i>a <code>Square</code> behaves exactly like a <code>Rectangle</code> but the <code>Square</code> has <code>Width == Heigth</code></i>.
</p>

<p>
As an object hierarchy this would look like the following:
</p>
<div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Rectangle</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">_width</span><span class="p">;</span>

<span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">_height</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">virtual</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Width</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">get</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">_width</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="k">set</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">_width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">value</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">virtual</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Height</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">get</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">_height</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="k">set</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">_height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">value</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Square</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Rectangle</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Width</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">get</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">_width</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="k">set</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">_width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">value</span><span class="p">;</span>
<span class="w">            </span><span class="n">_height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">value</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Height</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">get</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">_height</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="k">set</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">_height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">value</span><span class="p">;</span>
<span class="w">            </span><span class="n">_width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">value</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>
Now let' think of consumer of this code: it knows it's working with a <code>Rectangle</code> and sets all the values accordingly but it is given a <code>Square</code> to work with. Let's see that in code:
</p>
<div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Program</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ImageWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">800</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ImageHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">600</span><span class="p">;</span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">rectangle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Square</span><span class="p">();</span>
<span class="w">        </span><span class="n">InitializeRectangle</span><span class="p">(</span><span class="n">rectangle</span><span class="p">);</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rectangle</span><span class="p">.</span><span class="n">Width</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rectangle</span><span class="p">.</span><span class="n">Height</span><span class="p">;</span>
<span class="w">        </span><span class="n">Debug</span><span class="p">.</span><span class="n">Assert</span><span class="p">(</span><span class="n">area</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ImageWidth</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ImageHeight</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">void</span><span class="w"> </span><span class="nf">InitializeRectangle</span><span class="p">(</span><span class="n">Rectangle</span><span class="w"> </span><span class="n">rectangle</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">rectangle</span><span class="p">.</span><span class="n">Width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ImageWidth</span><span class="p">;</span>
<span class="w">        </span><span class="n">rectangle</span><span class="p">.</span><span class="n">Height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ImageHeight</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>
The method <code>InitializeRectangle</code> will perform it's work on a <code>Rectangle</code> thus will set its <code>Width</code> and <code>Height</code> properties and the <code>Main</code> method will be expecting to have an rectangle with the area of <code>ImageWidth * ImageHeight</code> but since the <code>Square</code> overrides the <code>Width</code> when <code>Height</code> is set (and viceversa) the actual area of the rectangle will be <code>ImageHeight * ImageHeight</code>.
</p>

<p>
This shows that although a <code>Square</code> may have a similar structure with an <code>Rectangle</code> it cannot be used as a substitute for a <code>Rectangle</code> because it doesn't have the same behavior.
</p>
</div>
</div>
<div id="outline-container-orgf5f1ef4" class="outline-4">
<h4 id="orgf5f1ef4">Interface Segregation principle</h4>
<div class="outline-text-4" id="text-orgf5f1ef4">
<blockquote>
<p>
<a href="https://en.wikipedia.org/wiki/Interface_segregation_principle">Many client-specific interfaces are better than one general-purpose interface.</a>
</p>
</blockquote>
<p>
To exemplify this let's consider some existing types within <code>.NET Framework</code>: <a href="https://msdn.microsoft.com/en-us/library/system.web.security.membershipprovider%2528v=vs.110%2529.aspx"><code>MembershipProvider</code></a> from <code>System.Web.Security</code> namespace and <a href="https://msdn.microsoft.com/en-us/library/dn613278%2528v=vs.108%2529.aspx"><code>IUserStore</code></a> from <code>Microsoft.AspNet.Identity</code> namespace:
</p>
<div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">MembershipProvider</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ProviderBase</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">EnablePasswordRetrieval</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">EnablePasswordReset</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">RequiresQuestionAndAnswer</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">ApplicationName</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MaxInvalidPasswordAttempts</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">PasswordAttemptWindow</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">RequiresUniqueEmail</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="n">MembershipPasswordFormat</span><span class="w"> </span><span class="n">PasswordFormat</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MinRequiredPasswordLength</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MinRequiredNonAlphanumericCharacters</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">PasswordStrengthRegularExpression</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">event</span><span class="w"> </span><span class="n">MembershipValidatePasswordEventHandler</span><span class="w"> </span><span class="n">ValidatingPassword</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="n">MembershipUser</span><span class="w"> </span><span class="nf">CreateUser</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">password</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">passwordQuestion</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">passwordAnswer</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">isApproved</span><span class="p">,</span><span class="w"> </span><span class="kt">object</span><span class="w"> </span><span class="n">providerUserKey</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">MembershipCreateStatus</span><span class="w"> </span><span class="n">status</span><span class="p">);</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">ChangePasswordQuestionAndAnswer</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">password</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">newPasswordQuestion</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">newPasswordAnswer</span><span class="p">);</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nf">GetPassword</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">answer</span><span class="p">);</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">ChangePassword</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">oldPassword</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">newPassword</span><span class="p">);</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nf">ResetPassword</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">answer</span><span class="p">);</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">UpdateUser</span><span class="p">(</span><span class="n">MembershipUser</span><span class="w"> </span><span class="n">user</span><span class="p">);</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">ValidateUser</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">password</span><span class="p">);</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="n">MembershipUser</span><span class="w"> </span><span class="nf">GetUser</span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="n">providerUserKey</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">userIsOnline</span><span class="p">);</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="n">MembershipUser</span><span class="w"> </span><span class="nf">GetUser</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">userIsOnline</span><span class="p">);</span>

<span class="w">    </span><span class="k">internal</span><span class="w"> </span><span class="n">MembershipUser</span><span class="w"> </span><span class="nf">GetUser</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">userIsOnline</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">throwOnError</span><span class="p">)</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nf">GetUserNameByEmail</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">email</span><span class="p">);</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">DeleteUser</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">deleteAllRelatedData</span><span class="p">);</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="n">MembershipUserCollection</span><span class="w"> </span><span class="nf">GetAllUsers</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">pageIndex</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pageSize</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">totalRecords</span><span class="p">);</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">GetNumberOfUsersOnline</span><span class="p">();</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="n">MembershipUserCollection</span><span class="w"> </span><span class="nf">FindUsersByName</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">usernameToMatch</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pageIndex</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pageSize</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">totalRecords</span><span class="p">);</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="n">MembershipUserCollection</span><span class="w"> </span><span class="nf">FindUsersByEmail</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">emailToMatch</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pageIndex</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pageSize</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">totalRecords</span><span class="p">);</span>

<span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="k">virtual</span><span class="w"> </span><span class="kt">byte</span><span class="p">[]</span><span class="w"> </span><span class="nf">EncryptPassword</span><span class="p">(</span><span class="kt">byte</span><span class="p">[]</span><span class="w"> </span><span class="n">password</span><span class="p">)</span>

<span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="k">virtual</span><span class="w"> </span><span class="kt">byte</span><span class="p">[]</span><span class="w"> </span><span class="nf">EncryptPassword</span><span class="p">(</span><span class="kt">byte</span><span class="p">[]</span><span class="w"> </span><span class="n">password</span><span class="p">,</span><span class="w"> </span><span class="n">MembershipPasswordCompatibilityMode</span><span class="w"> </span><span class="n">legacyPasswordCompatibilityMode</span><span class="p">)</span>

<span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="k">virtual</span><span class="w"> </span><span class="kt">byte</span><span class="p">[]</span><span class="w"> </span><span class="nf">DecryptPassword</span><span class="p">(</span><span class="kt">byte</span><span class="p">[]</span><span class="w"> </span><span class="n">encodedPassword</span><span class="p">)</span>

<span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="k">virtual</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">OnValidatingPassword</span><span class="p">(</span><span class="n">ValidatePasswordEventArgs</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>

<span class="p">}</span>


<span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IUserStore</span><span class="o">&lt;</span><span class="n">TUser</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">TKey</span><span class="o">&gt;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IDisposable</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">TUser</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">class</span><span class="p">,</span><span class="w"> </span><span class="n">IUser</span><span class="o">&lt;</span><span class="n">TKey</span><span class="o">&gt;</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Task</span><span class="w"> </span><span class="nf">CreateAsync</span><span class="p">(</span><span class="n">TUser</span><span class="w"> </span><span class="n">user</span><span class="p">);</span>

<span class="w">    </span><span class="n">Task</span><span class="w"> </span><span class="nf">UpdateAsync</span><span class="p">(</span><span class="n">TUser</span><span class="w"> </span><span class="n">user</span><span class="p">);</span>

<span class="w">    </span><span class="n">Task</span><span class="w"> </span><span class="nf">DeleteAsync</span><span class="p">(</span><span class="n">TUser</span><span class="w"> </span><span class="n">user</span><span class="p">);</span>

<span class="w">    </span><span class="n">Task</span><span class="o">&lt;</span><span class="n">TUser</span><span class="o">&gt;</span><span class="w"> </span><span class="n">FindByIdAsync</span><span class="p">(</span><span class="n">TKey</span><span class="w"> </span><span class="n">userId</span><span class="p">);</span>

<span class="w">    </span><span class="n">Task</span><span class="o">&lt;</span><span class="n">TUser</span><span class="o">&gt;</span><span class="w"> </span><span class="n">FindByNameAsync</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">userName</span><span class="p">);</span>
<span class="p">}</span>

<span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IUserPasswordStore</span><span class="o">&lt;</span><span class="n">TUser</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">TKey</span><span class="o">&gt;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IUserStore</span><span class="o">&lt;</span><span class="n">TUser</span><span class="p">,</span><span class="w"> </span><span class="n">TKey</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">IDisposable</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">TUser</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">class</span><span class="p">,</span><span class="w"> </span><span class="n">IUser</span><span class="o">&lt;</span><span class="n">TKey</span><span class="o">&gt;</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">Task</span><span class="w"> </span><span class="nf">SetPasswordHashAsync</span><span class="p">(</span><span class="n">TUser</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">passwordHash</span><span class="p">);</span>

<span class="w">    </span><span class="n">Task</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GetPasswordHashAsync</span><span class="p">(</span><span class="n">TUser</span><span class="w"> </span><span class="n">user</span><span class="p">);</span>

<span class="w">    </span><span class="n">Task</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="w"> </span><span class="n">HasPasswordAsync</span><span class="p">(</span><span class="n">TUser</span><span class="w"> </span><span class="n">user</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
<p>
If we would have to implement a simple authentication mechanism the functionality of <code>IUserStore</code> and <code>IUserPasswordStore</code> would be sufficient for our needs. Compare implementing only the functionality required for these two interfaces with the effort required to derive from the <code>MembershipProvider</code> class. Even worse, I can say from my experience that with the <code>MembershipProvider</code> you'll be writing code which will never be used.
</p>
</div>
</div>
<div id="outline-container-orge94fda2" class="outline-4">
<h4 id="orge94fda2">Dependency Inversion principle</h4>
<div class="outline-text-4" id="text-orge94fda2">
<blockquote>
<p>
<a href="https://en.wikipedia.org/wiki/Dependency_inversion_principle">Depend upon Abstractions. Do not depend upon concretions.</a>
</p>
</blockquote>
<p>
Let's go back to our <code>Singleton</code> example. In the previous module we stated that the <code>Explorer</code> class is <b>tightly coupled</b> with the <code>FileSystem</code> class thus depending on it and also depending on underlying file system for tests to succed.
</p>

<p>
To break this dependency we need to hide the functionality of our <code>FileSystem</code> behind an abstraction and we do that using an interface <code>IFileSystem</code> which will be implemented by <code>FileSystem</code> class:
</p>
<div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IFileSystem</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="nf">List</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">FileSystem</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IFileSystem</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="nf">List</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Directory</span><span class="p">.</span><span class="n">EnumerateDirectories</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">Union</span><span class="p">(</span><span class="n">Directory</span><span class="p">.</span><span class="n">EnumerateFiles</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="n">ToArray</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>
Now we make the <code>Explorer</code> class depend upon the <code>IFileSystem</code> interface:
</p>
<div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Explorer</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">IFileSystem</span><span class="w"> </span><span class="n">_fileSystem</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">Explorer</span><span class="p">(</span><span class="n">IFileSystem</span><span class="w"> </span><span class="n">fileSystem</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_fileSystem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fileSystem</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">CurrentDirectory</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Contents</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">NavigateTo</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">contents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_fileSystem</span><span class="p">.</span><span class="n">Root</span><span class="p">.</span><span class="n">List</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
<span class="w">        </span><span class="n">CurrentDirectory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">path</span><span class="p">;</span>
<span class="w">        </span><span class="n">Contents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">contents</span><span class="p">;</span>

<span class="w">        </span><span class="k">foreach</span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">contents</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">Display</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>
Now it's up to the <code>Program</code> class to glue them together:
</p>
<div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Program</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileSystem</span><span class="p">();</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">explorer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Explorer</span><span class="p">(</span><span class="n">fs</span><span class="p">);</span>
<span class="w">        </span><span class="n">explorer</span><span class="p">.</span><span class="n">NavigateTo</span><span class="p">(</span><span class="s">@"c:\users\petru\Documents\"</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>
This way we can test the <code>Explorer</code> class separately from the <code>FileSystem</code> class by passing it an instance of a class that implements <code>IFileSystem</code> and returns some stub data.
</p>

<p>
As an additional bonus, the semantics of the <code>Singleton</code> is still in place - there is <b>only one instance</b> of the <code>FileSystem</code> class for the whole lifetime of the application.
</p>
</div>
</div>
</div>
</div>
    </div>
    </article>
</div>
        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="." rel="prev">Newer posts</a>
            </li>
        </ul></nav><script>var disqus_shortname="rebeja";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
                <script src="assets/js/all-nocdn.js" type="text/javascript"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
